# =============================================================================
# Redis Configuration for Ulixai - Production
# =============================================================================
# Fichier: /etc/redis/redis.conf (ou ajouter à la fin)
# Redémarrer: sudo systemctl restart redis-server
# =============================================================================

# =============================================================================
# Network
# =============================================================================
bind 127.0.0.1
port 6379
protected-mode yes

# =============================================================================
# Memory Management
# =============================================================================
# Ajuster selon RAM disponible (25% de la RAM totale recommandé)
# - 2GB RAM: maxmemory 512mb
# - 4GB RAM: maxmemory 1gb
# - 8GB RAM: maxmemory 2gb
maxmemory 1gb

# Politique d'éviction (supprime les clés les moins utilisées quand plein)
maxmemory-policy allkeys-lru

# =============================================================================
# Persistence (RDB snapshots)
# =============================================================================
save 900 1
save 300 10
save 60 10000

dbfilename dump.rdb
dir /var/lib/redis

# =============================================================================
# Append Only File (AOF) - Plus de durabilité
# =============================================================================
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec

# =============================================================================
# Performance
# =============================================================================
tcp-keepalive 300
timeout 0

# Optimisations
activerehashing yes
hz 10

# Lazy freeing (évite les blocages)
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# =============================================================================
# Logging
# =============================================================================
loglevel notice
logfile /var/log/redis/redis-server.log

# =============================================================================
# Security
# =============================================================================
# Décommenter et définir un mot de passe en production
# requirepass your_super_secure_redis_password_here

# Désactiver les commandes dangereuses
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
rename-command CONFIG ""
