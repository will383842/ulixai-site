/*! For license information please see request-form.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.toStringTag||"@@toStringTag";function i(t,o,a,s){var i=o&&o.prototype instanceof l?o:l,u=Object.create(i.prototype);return n(u,"_invoke",function(t,n,o){var a,s,i,l=0,u=o||[],d=!1,m={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,i=e,m.n=n,c}};function p(t,n){for(s=t,i=n,r=0;!d&&l&&!o&&r<u.length;r++){var o,a=u[r],p=m.p,g=a[2];t>3?(o=g===n)&&(i=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=t<2&&p<a[1])?(s=0,m.v=n,m.n=a[1]):p<g&&(o=t<3||a[0]>n||n>g)&&(a[4]=t,a[5]=n,m.n=g,s=0))}if(o||t>1)return c;throw d=!0,n}return function(o,u,g){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&p(u,g),s=u,i=g;(r=s<2?e:i)||!d;){a||(s?s<3?(s>1&&(m.n=-1),p(s,i)):m.n=i:m.v=i);try{if(l=2,a){if(s||(o="next"),r=a[o]){if(!(r=r.call(a,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,s<2&&(s=0)}else 1===s&&(r=a.return)&&r.call(a),s<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((r=(d=m.n<0)?i:t.call(n,m))!==c)break}catch(t){a=e,s=1,i=t}finally{l=1}}return{value:r,done:d}}}(t,a,s),!0),u}var c={};function l(){}function u(){}function d(){}r=Object.getPrototypeOf;var m=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),p=d.prototype=l.prototype=Object.create(m);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,s,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=d,n(p,"constructor",d),n(d,"constructor",u),u.displayName="GeneratorFunction",n(d,s,"GeneratorFunction"),n(p),n(p,s,"Generator"),n(p,a,function(){return this}),n(p,"toString",function(){return"[object Generator]"}),(t=function(){return{w:i,m:g}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function s(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(s("next",0),s("throw",1),s("return",2))},n(e,t,r,o)}function r(e,t,n,r,o,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var s=e.apply(t,n);function i(e){r(s,o,a,i,c,"next",e)}function c(e){r(s,o,a,i,c,"throw",e)}i(void 0)})}}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,s,i=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){l(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(t,n,r){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}!function(e,n,r,s,i){"use strict";var l={DEBOUNCE_DELAY:300,SUBMIT_COOLDOWN:5e3,MIN_FORM_TIME:10,IMAGE_MAX_SIZE:5242880,IMAGE_MAX_WIDTH:1200,IMAGE_QUALITY:.8,VALID_IMAGE_TYPES:["image/jpeg","image/jpg","image/png","image/gif","image/webp"]},u="",d=!1,m=!1,p=0,g=0,f={steps:null,nextBtn:null,prevBtn:null,progressBar:null,stepLabel:null,stepCounter:null,funText:null,stickyNav:null,requestTitle:null,titleCount:null,titleCounter:null,moreDetails:null,detailsCount:null,detailsCounter:null,password:null,strengthBar:null,strengthLabel:null,cachedSelectors:{supportType:null,urgency:null,languages:null,lastUpdate:0}},h=window.matchMedia("(prefers-reduced-motion: reduce)").matches,y=null,v=0;function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"polite",n=document.getElementById("a11y-announcer");n||((n=document.createElement("div")).id="a11y-announcer",n.className="sr-only",n.setAttribute("aria-live",t),n.setAttribute("aria-atomic","true"),document.body.appendChild(n)),n.textContent="",setTimeout(function(){n.textContent=e},100),setTimeout(function(){n.textContent=""},3e3)}function E(e,t){var n;return function(){for(var r=this,o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];clearTimeout(n),n=setTimeout(function(){clearTimeout(n),e.apply(r,a)},t)}}function w(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=Date.now();return f.cachedSelectors[e]&&r-f.cachedSelectors.lastUpdate<n||(f.cachedSelectors[e]=document.querySelector(t),f.cachedSelectors.lastUpdate=r),f.cachedSelectors[e]}function x(e){if("string"!=typeof e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}function B(e){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)&&e.length<=254}function I(e){if(!e)throw new Error("No file provided");if(!l.VALID_IMAGE_TYPES.includes(e.type))throw new Error("Invalid file type. Only images (JPG, PNG, GIF, WebP) are allowed.");if(e.size>l.IMAGE_MAX_SIZE)throw new Error("File size must be less than 5MB");return!0}function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.IMAGE_MAX_WIDTH,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.IMAGE_QUALITY;return new Promise(function(r,o){try{I(e);var a=new FileReader;a.onerror=function(){return o(new Error("Failed to read file"))},a.onload=function(a){var s=new Image;s.onerror=function(){return o(new Error("Failed to load image"))},s.onload=function(){var a=document.createElement("canvas"),i=s.width,c=s.height;i>t&&(c=Math.round(c*t/i),i=t),a.width=i,a.height=c;var l=a.getContext("2d",{alpha:!1});l?(l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(s,0,0,i,c),a.toBlob(function(t){if(t){var n=new File([t],e.name.replace(/\.\w+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()});console.log("üì∏ Compression:",Math.round(e.size/1024)+"KB ‚Üí",Math.round(n.size/1024)+"KB"),r(n)}else o(new Error("Failed to compress image"))},"image/jpeg",n)):o(new Error("Failed to get canvas context"))},s.src=a.target.result},a.readAsDataURL(e)}catch(e){o(e)}})}var k=(null===(e=window.formConfig)||void 0===e?void 0:e.funTexts)||[],C=(null===(n=window.formConfig)||void 0===n?void 0:n.stepLabels)||[],L=(null===(r=window.formConfig)||void 0===r?void 0:r.isAuthenticated)||!1,A=(null===(s=window.formConfig)||void 0===s?void 0:s.checkEmailUrl)||"",T=(null===(i=window.formConfig)||void 0===i?void 0:i.verifyPasswordUrl)||"";function O(e,t){var n=document.getElementById("welcomeMessage"),r=document.getElementById("welcomeTitle"),o=document.getElementById("welcomeText");if(n&&r&&o){var a=x(t);switch(e){case"new":r.textContent="üëã Welcome!",o.textContent="Let's create your account üéâ",b("Welcome! Creating your account","polite");break;case"returning-with-cookie":case"returning-without-cookie":r.textContent="Hey ".concat(a,"! üëã"),o.textContent="Happy to see you back! ‚ú®",b("Welcome back ".concat(a,"!"),"polite")}n.classList.remove("hidden"),h||(n.style.animation="slideInDown 0.5s ease-out")}}function D(e){if(e<0||e>=15)console.error("‚ùå Invalid step index:",e);else{L&&e>=9&&e<=11&&(g=12,e=12),f.steps.forEach(function(t,n){n===e?(t.classList.remove("hidden"),t.setAttribute("aria-hidden","false")):(t.classList.add("hidden"),t.setAttribute("aria-hidden","true"))}),14===e&&setTimeout(function(){var e=document.getElementById("see-my-ad"),t=localStorage.getItem("current-mission-id");t&&e&&(e.href="/quote-offer?id="+encodeURIComponent(t),console.log("‚úÖ Ad link updated:",e.href))},100);var t=(e+1)/15*100;if(f.progressBar)if(h)f.progressBar.style.width=t+"%";else{var n=function(){a++;var e=r+(o-r)*(a/s);f.progressBar.style.width=e+"%",f.progressBar.setAttribute("aria-valuenow",Math.round(e)),a<s&&requestAnimationFrame(n)},r=parseFloat(f.progressBar.style.width)||0,o=t,a=0,s=20;requestAnimationFrame(n)}if(f.stepLabel&&C[e]&&(f.stepLabel.textContent=C[e]),f.stepCounter&&(f.stepCounter.textContent=e<12?"Step "+(e+1):12===e?"Step 12":""),f.funText&&k[e]&&(f.funText.textContent=k[e].text,h||(f.funText.style.transition="color 0.3s ease"),f.funText.style.color=k[e].color),f.prevBtn&&(f.prevBtn.style.visibility=0===e?"hidden":"visible"),f.stickyNav&&(13===e||14===e?f.stickyNav.classList.add("hidden"):f.stickyNav.classList.remove("hidden")),13===e)setTimeout(function(){D(++g)},h?0:2e3);var i=f.steps[e];if(i&&13!==e&&14!==e){var c=i.querySelector('input:not([type="hidden"]):not(.lang-checkbox):not([disabled]), select:not([disabled]), textarea:not([disabled]), button[type="button"]:not(.photo-menu-btn):not([disabled])');c&&setTimeout(function(){c.focus()},100)}if(C[e]){var l=e<12?"Step ".concat(e+1," of ").concat(15):"Final step";b("".concat(l,": ").concat(C[e]),"polite")}_()}}function q(e){if([13,14].includes(e))return!0;var t=!0,n="";switch(e){case 0:var r=document.getElementById("countryNeed");r&&r.value||(n="Please select a country",t=!1,r&&r.focus());break;case 1:var o=document.getElementById("originCountry");o&&o.value||(n="Please select your country of origin",t=!1,o&&o.focus());break;case 2:case 5:t=!0;break;case 3:var a=document.getElementById("durationHere");a&&a.value||(n="Please select how long you have been here",t=!1);break;case 4:var s=document.getElementById("requestTitle"),i=document.getElementById("moreDetails");!s||!s.value||s.value.trim().length<15?(n="Title must be at least 15 characters",t=!1,s&&s.focus()):(!i||!i.value||i.value.trim().length<50)&&(n="Details must be at least 50 characters",t=!1,i&&i.focus());break;case 6:w("supportType",'input[name="supportType"]:checked')||(n="Please select a support type",t=!1);break;case 7:w("urgency",'input[name="urgency"]:checked')||(n="Please select urgency level",t=!1);break;case 8:0===document.querySelectorAll('input[name="languages[]"]:checked').length&&(n="Please select at least one language",t=!1);break;case 9:var c=document.getElementById("firstName");c&&c.value.trim()||(n="Please enter your first name",t=!1,c&&c.focus());break;case 10:var l=document.getElementById("email"),m=l?l.value.trim():"";return m&&B(m)?(f.nextBtn&&(f.nextBtn.disabled=!0,f.nextBtn.textContent="Checking..."),function(e){if(!A)return console.error("‚ùå checkEmailUrl not configured"),Promise.resolve({exists:!1,has_valid_cookie:!1});var t=document.querySelector('meta[name="csrf-token"]');return t?fetch(A,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t.getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:x(e)})}).then(function(e){if(!e.ok)throw new Error("Network error: "+e.status);return e.json()}).then(function(e){return console.log("üìß Email check result:",e),e}).catch(function(e){return console.error("‚ùå Error checking email:",e),{exists:!1,has_valid_cookie:!1}}):(console.error("‚ùå CSRF token not found"),Promise.resolve({exists:!1,has_valid_cookie:!1}))}(m).then(function(e){e.exists&&e.has_valid_cookie?(O("returning-with-cookie",u=e.first_name||"there"),setTimeout(function(){g=11,R(10),D(++g)},1500)):e.exists&&!e.has_valid_cookie?(O("returning-without-cookie",u=e.first_name||"there"),setTimeout(function(){R(10),g++,function(e){d=!0;var t=document.getElementById("passwordWelcomeMessage"),n=document.getElementById("passwordWelcomeTitle"),r=document.getElementById("passwordWelcomeText"),o=document.getElementById("passwordLabel"),a=document.getElementById("password"),s=document.getElementById("passwordStrength"),i=document.getElementById("passwordInfoText"),c=x(e);t&&n&&r&&(n.textContent="Hey ".concat(c,"! üëã"),r.textContent="Happy to see you back!",t.classList.remove("hidden")),a&&(a.placeholder="Enter your password",a.value=""),o&&(o.textContent="Password"),s&&(s.style.display="none"),i&&(i.innerHTML="üîê For security, please enter your <strong>password</strong>"),b("Please enter your password to continue","polite")}(u),D(g)},1500)):(O("new",""),setTimeout(function(){R(10),g++,function(){d=!1;var e=document.getElementById("passwordWelcomeMessage"),t=document.getElementById("passwordLabel"),n=document.getElementById("password"),r=document.getElementById("passwordStrength"),o=document.getElementById("passwordInfoText");e&&e.classList.add("hidden"),n&&(n.placeholder="Choose a secure password (min 6 chars)",n.value=""),t&&(t.textContent="Choose a password (minimum 6 characters)"),r&&(r.style.display="block"),o&&(o.innerHTML="üîê Use at least <strong>6 characters</strong> ‚Äî 8+ recommended"),b("Create a secure password for your account","polite")}(),D(g)},1e3)),f.nextBtn&&(f.nextBtn.disabled=!1,f.nextBtn.textContent="Next ‚Üí")}).catch(function(e){console.error("Email check error:",e),f.nextBtn&&(f.nextBtn.disabled=!1,f.nextBtn.textContent="Next ‚Üí")}),!1):(n="Please enter a valid email address",t=!1,l&&l.focus(),M(n),!1);case 11:var p=document.getElementById("password");if(!p||!p.value||p.value.length<6)return n="Password must be at least 6 characters",t=!1,p&&p.focus(),M(n),!1;if(d){var y=document.getElementById("email");return!!y&&(f.nextBtn&&(f.nextBtn.disabled=!0,f.nextBtn.textContent="Verifying..."),function(e,t){if(!T)return console.error("‚ùå verifyPasswordUrl not configured"),Promise.resolve({success:!1,message:"Configuration error"});var n=document.querySelector('meta[name="csrf-token"]');return n?fetch(T,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n.getAttribute("content"),"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:x(e),password:t})}).then(function(e){if(!e.ok)throw new Error("Network error: "+e.status);return e.json()}).then(function(e){return console.log("üîê Password verification result:",e),e}).catch(function(e){return console.error("‚ùå Error verifying password:",e),{success:!1,message:"Verification failed. Please try again."}}):(console.error("‚ùå CSRF token not found"),Promise.resolve({success:!1,message:"Security error"}))}(y.value,p.value).then(function(e){e.success?(console.log("‚úÖ Password correct"),R(11),D(++g)):(M(e.message||"Wrong password, please try again"),p.value="",p.focus()),f.nextBtn&&(f.nextBtn.disabled=!1,f.nextBtn.textContent="Next ‚Üí")}).catch(function(e){console.error("Password verification error:",e),f.nextBtn&&(f.nextBtn.disabled=!1,f.nextBtn.textContent="Next ‚Üí")}),!1)}break;case 12:var v=document.getElementById("serviceDuration"),E=document.getElementById("termsCheckbox");v&&v.value?E&&E.checked||(!function(){var e=document.getElementById("cgvWarning");if(e){e.classList.remove("hidden"),e.style.zIndex="10000",b("Don't forget to accept the terms and conditions","assertive"),setTimeout(function(){e.classList.add("hidden")},h?2e3:3e3)}}(),t=!1,E&&E.focus()):(n="Please select service duration",t=!1)}return!t&&n&&M(n),t}function M(e){var t=document.getElementById("validationError"),n=document.getElementById("validationMessage");t&&n&&(n.textContent=x(e),t.classList.remove("hidden"),t.style.zIndex="10000",b("Error: "+e,"assertive"),setTimeout(function(){t.classList.add("hidden")},h?2e3:3e3))}var N,P,j,_=(N=function(){if(f.nextBtn){var e=!1;switch(g){case 0:var t=document.getElementById("countryNeed");e=!(!t||!t.value);break;case 1:var n=document.getElementById("originCountry");e=!(!n||!n.value);break;case 2:case 5:default:e=!0;break;case 3:var r=document.getElementById("durationHere");e=!(!r||!r.value);break;case 4:var o=document.getElementById("requestTitle"),a=document.getElementById("moreDetails");e=!!(o&&a&&o.value.trim().length>=15&&a.value.trim().length>=50);break;case 6:e=!!w("supportType",'input[name="supportType"]:checked',500);break;case 7:e=!!w("urgency",'input[name="urgency"]:checked',500);break;case 8:e=document.querySelectorAll('input[name="languages[]"]:checked').length>0;break;case 9:var s=document.getElementById("firstName");e=!(!s||!s.value.trim());break;case 10:var i=document.getElementById("email");e=B(i?i.value.trim():"");break;case 11:var c=document.getElementById("password");e=!!(c&&c.value.length>=6);break;case 12:var l=document.getElementById("serviceDuration"),u=document.getElementById("termsCheckbox");e=!!(l&&l.value&&u&&u.checked)}f.nextBtn.disabled=!e,f.nextBtn.setAttribute("aria-disabled",!e)}},P=100,function(){if(!j){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];N.apply(this,t),j=!0,setTimeout(function(){return j=!1},P)}});function F(){var e=Date.now();if(y&&e-v<500)return c({},y);try{return y=JSON.parse(localStorage.getItem("help-request"))||{},v=e,c({},y)}catch(e){return console.error("Error reading localStorage:",e),{}}}function R(e){var t=F();switch(e){case 0:var n=document.getElementById("countryNeed");t.countryNeed=n?x(n.value):"";break;case 1:var r=document.getElementById("originCountry");t.originCountry=r?x(r.value):"";break;case 2:var o=document.getElementById("currentCity");t.currentCity=o?x(o.value):"";break;case 3:var a=document.getElementById("durationHere");t.durationHere=a?x(a.value):"";break;case 4:var s=document.getElementById("requestTitle"),i=document.getElementById("moreDetails");t.requestTitle=s?x(s.value):"",t.moreDetails=i?x(i.value):"";break;case 6:var l=document.querySelector('input[name="supportType"]:checked');t.supportType=l?l.value:null;break;case 7:var u=document.querySelector('input[name="urgency"]:checked');t.urgency=u?u.value:null;break;case 8:var d=Array.from(document.querySelectorAll('input[name="languages[]"]:checked')).map(function(e){return x(e.value)});t.languages=d;break;case 9:var m=document.getElementById("firstName");t.firstName=m?x(m.value):"";break;case 10:var p=document.getElementById("email");t.email=p?x(p.value):"";break;case 11:break;case 12:var g=document.getElementById("serviceDuration");t.serviceDuration=g?x(g.value):"";var f=document.getElementById("termsCheckbox");f&&(t.termsAccepted=f.checked,f.checked&&(t.termsAcceptedAt=(new Date).toISOString(),console.log("‚úÖ [GDPR] Terms accepted at:",t.termsAcceptedAt)))}!function(e){try{localStorage.setItem("help-request",JSON.stringify(e)),y=c({},e),v=Date.now()}catch(e){console.error("Error writing localStorage:",e),"QuotaExceededError"===e.name&&M("Storage quota exceeded. Please clear some data.")}}(t)}function U(){f.nextBtn&&f.prevBtn?(f.nextBtn.addEventListener("click",function(){if(!this.disabled&&!m&&g<14){if(10===g||11===g&&d)return void q(g);if(!q(g))return;if(R(g),L&&8===g&&(g=11),12===g)return void function(){var e=Date.now();if(e-p<l.SUBMIT_COOLDOWN)return void M("Please wait a few seconds before submitting again");var t=document.getElementById("website");if(t&&""!==t.value)return console.warn("üçØ Honeypot triggered - possible bot"),void D(++g);var n=document.getElementById("timestamp");if(n){var r=parseInt(n.value);if(Math.floor(Date.now()/1e3)-r<l.MIN_FORM_TIME)return void M("Please take your time to fill the form properly")}m=!0,p=e;var o=document.getElementById("helpRequestForm");if(!o)return console.error("‚ùå Form not found"),void(m=!1);var s=new FormData(o),i=F();Object.entries(i).forEach(function(e){var t=a(e,2),n=t[0],r=t[1];s.has(n)||"password"===n||(Array.isArray(r)?r.forEach(function(e){return s.append(n+"[]",e)}):r&&s.append(n,r))});try{var c=JSON.parse(localStorage.getItem("create-request"))||{};c&&(s.append("category",c.category||""),s.append("subcategory",c.sub_category||""),s.append("subcategory2",c.child_category||""))}catch(e){console.error("Error adding categories:",e)}s.append("terms_version","1.0"),s.append("terms_accepted_at",i.termsAcceptedAt||(new Date).toISOString()),console.log("üìã [GDPR] Submitting with terms version 1.0"),f.nextBtn&&(f.nextBtn.disabled=!0,f.nextBtn.setAttribute("aria-busy","true"),f.nextBtn.textContent="Submitting...");b("Submitting your request, please wait","polite"),console.log("üì§ Submitting form...");var u=document.querySelector('meta[name="csrf-token"]');if(!u)return console.error("‚ùå CSRF token not found"),M("Security error. Please refresh the page."),m=!1,void(f.nextBtn&&(f.nextBtn.disabled=!1,f.nextBtn.setAttribute("aria-busy","false"),f.nextBtn.textContent="Next ‚Üí"));fetch(o.action,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":u.getAttribute("content")},body:s}).then(function(e){if(console.log("üì° Response status:",e.status),!e.ok)throw new Error("Server error: "+e.status);return e.json()}).then(function(e){console.log("‚úÖ Server response:",e),localStorage.removeItem("help-request"),localStorage.removeItem("create-request"),localStorage.removeItem("photo-previews"),e.mission_id&&(localStorage.setItem("current-mission-id",e.mission_id),console.log("üíæ Mission ID saved:",e.mission_id)),b("Your request has been submitted successfully!","polite"),m=!1,D(++g)}).catch(function(e){console.error("‚ùå Submission error:",e),M("Submission failed. Please check your connection and try again."),b("Submission failed. Please try again.","assertive"),m=!1}).finally(function(){f.nextBtn&&(f.nextBtn.disabled=!1,f.nextBtn.setAttribute("aria-busy","false"),f.nextBtn.textContent="Next ‚Üí")})}();D(++g)}}),f.prevBtn.addEventListener("click",function(){g>0&&(R(g),L&&12===g?g=8:g--,D(g))})):console.error("‚ùå Navigation buttons not found")}function H(){var e=document.querySelectorAll(".photo-upload-box"),n=document.getElementById("photoMenuModal"),r=document.querySelectorAll(".photo-menu-option"),a=document.getElementById("closePhotoMenuModal"),s=null,i=null,c=document.getElementById("cameraModal"),l=document.getElementById("cameraVideo"),u=document.getElementById("capturePhotoBtn"),d=document.getElementById("closeCameraModal"),m=null,p=1,g=null,f=document.getElementById("photoZoomModal"),h=document.getElementById("zoomedImage"),y=document.getElementById("closeZoomModal"),v=document.getElementById("zoomIn"),b=document.getElementById("zoomOut"),E=document.getElementById("resetZoom"),w=document.getElementById("deletePhoto");function x(){c&&c.classList.add("hidden"),m&&(m.getTracks().forEach(function(e){return e.stop()}),m=null),l&&l.srcObject&&(l.srcObject.getTracks().forEach(function(e){return e.stop()}),l.srcObject=null)}function B(){f&&(f.classList.add("hidden"),f.classList.remove("flex")),g=null,p=1,document.body.style.overflow=""}e.forEach(function(e){var r=e.querySelector(".photo-menu-btn"),a=e.querySelector(".photo-input"),c=e.querySelector(".photo-preview");r&&a&&c&&(r.addEventListener("click",function(t){t.preventDefault(),e.classList.contains("has-photo")?function(e,t){g=t,h&&(h.src=e);p=1,h&&(h.style.transform="scale(1)");f&&(f.classList.remove("hidden"),f.classList.add("flex"));document.body.style.overflow="hidden"}(c.src,e):(s=a,i=c,n&&(n.classList.remove("hidden"),n.style.zIndex="9999"))}),a.addEventListener("change",function(){var n=o(t().m(function n(r){var o,s,i,l,u,d;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:if(o=r.target.files[0]){t.n=1;break}return t.a(2);case 1:return t.p=1,I(o),t.n=2,S(o,1200,.8);case 2:s=t.v,(i=new DataTransfer).items.add(s),a.files=i.files,l=URL.createObjectURL(s),c.src=l,e.classList.add("has-photo"),(u=e.querySelector(".photo-label"))&&u.classList.add("hidden"),(d=new FileReader).onload=function(e){try{var t=JSON.parse(localStorage.getItem("photo-previews"))||{};t[a.name]={base64:e.target.result,timestamp:Date.now()},localStorage.setItem("photo-previews",JSON.stringify(t)),console.log("üíæ Photo saved:",a.name)}catch(e){console.error("Error saving photo:",e)}},d.readAsDataURL(s),t.n=4;break;case 3:t.p=3,M(t.v.message),a.value="";case 4:return t.a(2)}},n,null,[[1,3]])}));return function(e){return n.apply(this,arguments)}}()))}),r.forEach(function(e){e.addEventListener("click",function(){var t=e.getAttribute("data-action");n&&n.classList.add("hidden"),s&&("library"===t||"file"===t?s.click():"camera"===t&&(c&&(c.classList.remove("hidden"),c.style.zIndex="9999"),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}).then(function(e){m=e,l&&(l.srcObject=e,l.play())}).catch(function(e){console.error("Camera access denied:",e),M("Camera access denied"),c&&c.classList.add("hidden")})))})}),a&&(a.onclick=function(){n&&n.classList.add("hidden")}),n&&n.addEventListener("click",function(e){e.target===this&&this.classList.add("hidden")}),d&&(d.onclick=x),c&&c.addEventListener("click",function(e){e.target===this&&x()}),u&&l&&(u.onclick=o(t().m(function e(){var n;return t().w(function(e){for(;;)switch(e.n){case 0:if(l.srcObject){e.n=1;break}return e.a(2);case 1:(n=document.createElement("canvas")).width=l.videoWidth,n.height=l.videoHeight,n.getContext("2d").drawImage(l,0,0,n.width,n.height),n.toBlob(function(){var e=o(t().m(function e(n){var r,o,a,c,l,u,d;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,r=new File([n],"camera-photo-"+Date.now()+".png",{type:"image/png",lastModified:Date.now()}),e.n=1,S(r,1200,.8);case 1:r=e.v,(o=new DataTransfer).items.add(r),s&&(s.files=o.files,console.log("üì∏ Photo captured:",r.size,"bytes"),a=URL.createObjectURL(r),i&&(i.src=a,(c=s.closest(".photo-upload-box"))&&(c.classList.add("has-photo"),(l=c.querySelector(".photo-label"))&&l.classList.add("hidden"))),(u=new FileReader).onload=function(e){try{var t=JSON.parse(localStorage.getItem("photo-previews"))||{};t[s.name]={base64:e.target.result,timestamp:Date.now()},localStorage.setItem("photo-previews",JSON.stringify(t)),console.log("üíæ Camera photo saved")}catch(e){console.error("Error saving camera photo:",e)}},u.readAsDataURL(r)),x(),e.n=3;break;case 2:e.p=2,d=e.v,console.error("Error processing camera photo:",d),M("Failed to process photo");case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),"image/png",.95);case 2:return e.a(2)}},e)}))),y&&y.addEventListener("click",B),f&&f.addEventListener("click",function(e){e.target===this&&B()}),v&&h&&v.addEventListener("click",function(){p=Math.min(p+.25,3),h.style.transform="scale(".concat(p,")")}),b&&h&&b.addEventListener("click",function(){p=Math.max(p-.25,.5),h.style.transform="scale(".concat(p,")")}),E&&h&&E.addEventListener("click",function(){p=1,h.style.transform="scale(1)"}),w&&w.addEventListener("click",function(){if(g){var e=g.querySelector(".photo-input"),t=g.querySelector(".photo-preview"),n=g.querySelector(".photo-label");if(e&&(e.value=""),t&&(t.src=t.getAttribute("data-default-src")||"/images/uploadpng.png"),g.classList.remove("has-photo"),n&&n.classList.remove("hidden"),e)try{var r=JSON.parse(localStorage.getItem("photo-previews"))||{};delete r[e.name],localStorage.setItem("photo-previews",JSON.stringify(r)),console.log("üóëÔ∏è Photo deleted:",e.name)}catch(e){console.error("Error deleting photo:",e)}B()}})}function z(){var e,t,n,r,o,s,i;(console.log("üöÄ [RequestForm] Starting initialization..."),console.log("üîç [DOM] Searching for elements..."),f.steps=document.querySelectorAll(".form-step"),f.nextBtn=document.getElementById("nextBtn"),f.prevBtn=document.getElementById("prevBtn"),f.progressBar=document.getElementById("progressBar"),f.stepLabel=document.getElementById("formStepLabel"),f.stepCounter=document.getElementById("stepCounter"),f.funText=document.getElementById("funText"),f.stickyNav=document.getElementById("stickyNav"),f.requestTitle=document.getElementById("requestTitle"),f.titleCount=document.getElementById("titleCount"),f.titleCounter=document.getElementById("titleCounter"),f.moreDetails=document.getElementById("moreDetails"),f.detailsCount=document.getElementById("detailsCount"),f.detailsCounter=document.getElementById("detailsCounter"),f.password=document.getElementById("password"),f.strengthBar=document.getElementById("strengthBar"),f.strengthLabel=document.getElementById("strengthLabel"),f.steps&&0!==f.steps.length?(console.log("‚úÖ [DOM] Found",f.steps.length,"steps"),1):(console.error("‚ùå [DOM] Form steps not found!"),0))?(!function(){for(var e=F(),t={countryNeed:e.countryNeed,originCountry:e.originCountry,currentCity:e.currentCity,durationHere:e.durationHere,requestTitle:e.requestTitle,moreDetails:e.moreDetails,firstName:e.firstName,email:e.email,serviceDuration:e.serviceDuration},n=0,r=Object.entries(t);n<r.length;n++){var o=a(r[n],2),s=o[0],i=o[1];if(i){var c=document.getElementById(s);c&&(c.value=i,["requestTitle","moreDetails"].includes(s)&&c.dispatchEvent(new Event("input",{bubbles:!0})))}}if(void 0!==e.termsAccepted){var l=document.getElementById("termsCheckbox");l&&(l.checked=e.termsAccepted,console.log("üîÑ [GDPR] Terms checkbox restored:",e.termsAccepted),e.termsAcceptedAt&&console.log("üìÖ [GDPR] Originally accepted at:",e.termsAcceptedAt))}e.languages&&Array.isArray(e.languages)&&e.languages.forEach(function(e){try{var t=document.querySelector('input[name="languages[]"][value="'.concat(CSS.escape(e),'"]'));if(t){t.checked=!0;var n=t.closest(".lang-option");n&&(n.className="lang-option border-2 rounded-2xl px-3 py-3 cursor-pointer transition-all shadow-sm hover:shadow-md flex items-center justify-center gap-2 bg-blue-600 text-white border-blue-700")}}catch(t){console.error("Error restoring language:",e,t)}});try{var u=JSON.parse(localStorage.getItem("photo-previews"))||{};for(var d in u){var m,p=document.querySelector('input[name="'.concat(CSS.escape(d),'"]')),g=null==p||null===(m=p.closest(".photo-upload-box"))||void 0===m?void 0:m.querySelector(".photo-preview");if(g&&u[d].base64){g.src=u[d].base64;var f=p.closest(".photo-upload-box");if(f){f.classList.add("has-photo");var h=f.querySelector(".photo-label");h&&h.classList.add("hidden")}}}}catch(e){console.error("Error restoring photos:",e)}}(),function(){if(f.requestTitle&&f.titleCount){var e=E(function(){var e=this.value.length;f.titleCount.textContent=e+"/15",e>=15?(f.titleCounter.className="mt-3 text-sm text-green-700 bg-green-50 border-green-300 p-3 rounded-xl border-2 shadow-sm",f.titleCounter.innerHTML='‚úÖ Minimum 15 characters ‚Ä¢ <span id="titleCount">'+e+"/15</span>"):(f.titleCounter.className="mt-3 text-sm text-orange-600 bg-orange-50 border-orange-300 p-3 rounded-xl border-2 shadow-sm",f.titleCounter.innerHTML='‚ö†Ô∏è Minimum 15 characters ‚Ä¢ <span id="titleCount">'+e+"/15</span>"),_()},l.DEBOUNCE_DELAY);f.requestTitle.addEventListener("input",e)}if(f.moreDetails&&f.detailsCount){var t=E(function(){var e=this.value.length;f.detailsCount.textContent=e,e>=50?(f.detailsCounter.className="mt-3 text-sm flex justify-between text-green-700 bg-green-50 border-green-300 p-3 rounded-xl border-2 shadow-sm",f.detailsCounter.innerHTML='<span>‚úÖ Min 50 chars</span><span class="text-gray-700"><span id="detailsCount">'+e+"</span>/50 (max 1500)</span>"):(f.detailsCounter.className="mt-3 text-sm flex justify-between text-orange-600 bg-orange-50 border-orange-300 p-3 rounded-xl border-2 shadow-sm",f.detailsCounter.innerHTML='<span>‚ö†Ô∏è Min 50 chars</span><span class="text-gray-700"><span id="detailsCount">'+e+"</span>/50 (max 1500)</span>"),_()},l.DEBOUNCE_DELAY);f.moreDetails.addEventListener("input",t)}}(),function(){if(f.password&&f.strengthBar){var e=E(function(){if(d)_();else{var e=this.value.length,t=0,n="Too short",r="bg-gray-300";e<6?(t=0,n="Too short",r="bg-gray-300"):e<8?(t=33,n="Weak",r="bg-red-500"):e<10?(t=66,n="Medium",r="bg-yellow-500"):(t=100,n="Strong",r="bg-green-500"),h||(f.strengthBar.style.transition="width 0.3s ease, background-color 0.3s ease"),f.strengthBar.style.width=t+"%",f.strengthBar.setAttribute("aria-valuenow",t),f.strengthBar.className="h-full transition-all duration-300 "+r,f.strengthLabel.textContent=n,_()}},100);f.password.addEventListener("input",e)}}(),e=document.querySelectorAll(".option-btn"),(t=document.getElementById("durationHere"))&&e.forEach(function(n){n.addEventListener("click",function(){e.forEach(function(e){e.className="option-btn border-2 rounded-2xl py-4 px-3 text-center font-semibold text-sm transition-all shadow-sm hover:shadow-md active:scale-95 border-blue-400 text-blue-700 bg-blue-50 hover:bg-blue-100",e.setAttribute("aria-pressed","false"),e.classList.contains("sm:col-span-2")&&e.classList.add("sm:col-span-2")}),this.className="option-btn border-2 rounded-2xl py-4 px-3 text-center font-semibold text-sm transition-all shadow-sm hover:shadow-md active:scale-95 bg-blue-600 text-white border-blue-700 shadow-lg",this.setAttribute("aria-pressed","true"),this.classList.contains("sm:col-span-2")&&this.classList.add("sm:col-span-2");var n=this.getAttribute("data-value");if(t.value=x(n),["1-2 years","2-5 years","More than 5 years"].includes(n)){var r=document.getElementById("expatPopup");r&&(r.classList.remove("hidden"),r.style.zIndex="9999",b("You might be interested in becoming an expat helper","polite"),h||setTimeout(function(){return r.classList.add("hidden")},5e3))}_()})}),(n=document.querySelectorAll(".support-option")).forEach(function(e){var t=e.querySelector('input[type="radio"]');t&&t.addEventListener("change",function(){if(n.forEach(function(e){e.className="support-option flex items-center justify-between gap-3 border-2 rounded-2xl px-4 py-3 cursor-pointer transition-all shadow-sm hover:shadow-md border-blue-500 bg-blue-50 text-blue-900 hover:bg-blue-100"}),this.checked){e.className="support-option flex items-center justify-between gap-3 border-2 rounded-2xl px-4 py-3 cursor-pointer transition-all shadow-sm hover:shadow-md bg-blue-600 text-white border-blue-700";var t=e.querySelector("span");t&&b("Selected: "+t.textContent,"polite")}f.cachedSelectors.supportType=null,_()})}),(r=document.querySelectorAll(".urgency-option")).forEach(function(e){var t=e.querySelector('input[type="radio"]');t&&t.addEventListener("change",function(){if(r.forEach(function(e){e.className="urgency-option flex items-center justify-between gap-3 border-2 rounded-2xl px-4 py-3 cursor-pointer transition-all shadow-sm hover:shadow-md border-blue-500 bg-blue-50 hover:bg-blue-100"}),this.checked){e.className="urgency-option flex items-center justify-between gap-3 border-2 rounded-2xl px-4 py-3 cursor-pointer transition-all shadow-sm hover:shadow-md bg-blue-600 text-white border-blue-700";var t=e.querySelector("span");t&&b("Selected: "+t.textContent,"polite")}f.cachedSelectors.urgency=null,_()})}),document.querySelectorAll(".lang-option").forEach(function(e){var t=e.querySelector(".lang-checkbox");t&&(e.addEventListener("click",function(e){e.preventDefault(),t.checked=!t.checked,t.checked?this.className="lang-option border-2 rounded-2xl px-3 py-3 cursor-pointer transition-all shadow-sm hover:shadow-md flex items-center justify-center gap-2 bg-blue-600 text-white border-blue-700":this.className="lang-option border-2 rounded-2xl px-3 py-3 cursor-pointer transition-all shadow-sm hover:shadow-md flex items-center justify-center gap-2 border-blue-400 bg-blue-50 hover:bg-blue-100 active:scale-95",f.cachedSelectors.languages=null,_()}),t.addEventListener("click",function(e){e.stopPropagation()}))}),o=document.querySelectorAll(".duration-btn"),(s=document.getElementById("serviceDuration"))&&o.forEach(function(e){e.addEventListener("click",function(){o.forEach(function(e){e.className="duration-btn border-2 rounded-2xl py-3 px-5 text-center font-semibold text-sm transition-all shadow-sm hover:shadow-md active:scale-95 border-blue-400 text-blue-700 bg-blue-50 hover:bg-blue-100",e.setAttribute("aria-pressed","false")}),this.className="duration-btn border-2 rounded-2xl py-3 px-5 text-center font-semibold text-sm transition-all shadow-sm hover:shadow-md active:scale-95 bg-blue-600 text-white border-blue-700 shadow-lg",this.setAttribute("aria-pressed","true");var e=this.getAttribute("data-duration");s.value=x(e),b("Selected: "+e,"polite"),_()})}),(i=document.getElementById("termsCheckbox"))&&i.addEventListener("change",function(){this.checked&&b("Terms and conditions accepted","polite"),_()}),U(),function(){var e=E(function(e){R(g),_()},l.DEBOUNCE_DELAY);document.querySelectorAll('input:not([type="hidden"]):not(.lang-checkbox):not([type="radio"]):not([type="checkbox"]), select, textarea').forEach(function(t){t.addEventListener("input",e)}),document.querySelectorAll('input[type="radio"], input[type="checkbox"]:not(.lang-checkbox)').forEach(function(e){e.addEventListener("change",function(){R(g),_()})});var t=document.getElementById("termsCheckbox");t&&t.addEventListener("change",function(){var e=this.checked;console.log("‚úÖ [GDPR] Terms checkbox changed:",e),e&&console.log("üìÖ [GDPR] User accepted terms at:",(new Date).toISOString()),R(g),_()}),document.addEventListener("keydown",function(e){if("Enter"===e.key&&!e.shiftKey&&f.nextBtn&&!f.nextBtn.disabled){var t=document.activeElement;t&&"TEXTAREA"!==t.tagName&&(e.preventDefault(),f.nextBtn.click())}})}(),H(),D(0),console.log("‚úÖ [RequestForm] Initialization complete")):console.error("‚ùå [RequestForm] Failed to initialize DOM elements")}"loading"===document.readyState?(console.log("‚è≥ [RequestForm] DOM is loading, waiting for DOMContentLoaded..."),document.addEventListener("DOMContentLoaded",z,{once:!0})):(console.log("‚úÖ [RequestForm] DOM already loaded, initializing immediately"),z())}()})();